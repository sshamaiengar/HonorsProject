{% extends "gd_base.html" %}

{% block css %}
<link href="../css/gamedev.css" rel="stylesheet">
<link href="../css/ocean.dark.css" rel="stylesheet">
<script type='text/javascript' src='../js/phaser.min.js'></script>
{% endblock %}

{% block pageContent %}
<div class="container">
	<div class="row">
		<div class="col-lg-12">
			<h1 class="page-header">Loops + Scene Setup</h1>
			<p class='lead'>After initializing the game and creating the sprites for the paddle and ball, we now need to do the latter for the bricks. However, rather than create every single brick individually, it would be faster and easier to create one brick (or a few with different colors) and basically clone it in several places across the screen. To do this, we will use an element common to nearly all programming languages: the <b>loop</b>.<br><br>
			Loops allow you to execute certain actions in a program for a specified number of times (known as a <b>for loop</b>) or until certain conditions are met (known as a <b>while loop</b>).<br><br>
			Our loop(s) will be used to create a grid of bricks. We can determine how many bricks we want to create (how many rows of bricks and how many bricks per row), so we will use a for loop. The basic syntax of a for loop is as follows:</p>
			<pre>for (var i = 0; i < maxValue; i++){
	// repeated actions here
}</pre>
			<p class='lead'>The part within the parentheses creates a temporary variable <span class='codeText'>i</span>, specifies a condition using <span class='codeText'>i</span> for when the loop should stop (such as when it equals a number <span class='codeText'>maxValue</span>), and then indicates how <span class='codeText'>i</span> should change with each iteration of the loop (<span class='codeText'>i++</span> is short for <span class='codeText'>i = i + 1</span>, meaning <span class='codeText'>i</span> will increase by 1 each iteration).<br><br>
			The value of <span class='codeText'>i</span> can be used in the code within the loop, thus allowing us to change how the actions of the loop are performed depending on the current iteration. For example, you could use the following code to simply print out all the numbers from 1 to 100:</p>
			<pre>for (var i = 1; i < 101; i++){
	console.log(i);
}</pre>
			<p class='lead'>That isn't very useful to us. We want to draw rectangles and then create bricks at different locations on the screen. To do this, we will use <span class='codeText'>i</span> to adjust the location where each new brick sprite is placed. First, we will write the code to place just one brick:</p>
			<pre>var brick;
graphics = game.add.graphics(0, 0);
graphics.beginFill(0x0000ff, 1);
graphics.drawRect(350, 560, 40, 20);
brick = game.add.sprite(104, 100, graphics.generateTexture());
game.physics.enable(brick, Phaser.Physics.ARCADE);
brick.body.bounce.set(1);
brick.body.immovable = true;
graphics.destroy();</pre>
			<p class='lead'>Similar to the code used to make the paddle, this code will draw a blue rectangle of width 40 and height 20 at a position near the top left of the screen and set up its physical properties, including preventing it from moving.</p>
		</div>
	</div>


	<!-- EXERCISE -->
	<div class="row" id = "exercise1">
		<div id="editorContainer1" class = 'col-lg-12' style = "background-color:#ecf0f1; padding-top:10px; padding-bottom:10px;">
			<p style='color:#7f8c8d;'>Using the code described above in the <b>create</b> function block below, add one brick to the screen.<br></p>
			<p style='color:#7f8c8d;'>If your code works properly, the blue brick should appear on screen.</p>
			<div id="editor1" class='editor col-lg-12'>var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

// add variables here
var ball;
var paddle;
var bricks;

// assign values to these variables
var ballOnPaddle = true;
var lives = 3;
var score = 0;

function preload(){

}

function create(){
	// add the initializing code below
	game.physics.startSystem(Phaser.Physics.ARCADE);
	game.physics.arcade.checkCollision.down = false;

	var graphics = game.add.graphics(0, 0);
	graphics.beginFill(0x68b0fd, 1);
	graphics.drawCircle(400, 550, 20);
	ball = game.add.sprite(game.world.centerX, 520, graphics.generateTexture());
	graphics.destroy();

	graphics = game.add.graphics(0, 0);
	graphics.beginFill(0xFFFFFF, 1);
	graphics.drawRect(350, 560, 100, 20);
	paddle = game.add.sprite(game.world.centerX,ball.y+20, graphics.generateTexture());
	graphics.destroy();
	
	//create ball body
    ball.anchor.set(0.5);
    ball.checkWorldBounds = true;
    game.physics.enable(ball, Phaser.Physics.ARCADE);
    ball.body.collideWorldBounds = true;
	ball.body.bounce.set(1);
	
	//create paddle
	paddle.anchor.setTo(0.5,0.5);
	game.physics.enable(paddle, Phaser.Physics.ARCADE);
	paddle.body.collideWorldBounds = true;
    paddle.body.bounce.set(1);
    paddle.body.immovable = true;
    paddle.body.allowGravity = false;
    paddle.body.enable = true;

    //create the brick here

}

function update(){

}
// print out the value of your variables, including game, below, and check them in the console

</div>
			<p hidden id='defaultCode1'>var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

// add variables here
var ball;
var paddle;
var bricks;

// assign values to these variables
var ballOnPaddle = true;
var lives = 3;
var score = 0;

function preload(){

}

function create(){
	// add the initializing code below
	game.physics.startSystem(Phaser.Physics.ARCADE);
	game.physics.arcade.checkCollision.down = false;

	var graphics = game.add.graphics(0, 0);
	graphics.beginFill(0x68b0fd, 1);
	graphics.drawCircle(400, 550, 20);
	ball = game.add.sprite(game.world.centerX, 520, graphics.generateTexture());
	graphics.destroy();

	graphics = game.add.graphics(0, 0);
	graphics.beginFill(0xFFFFFF, 1);
	graphics.drawRect(350, 560, 100, 20);
	paddle = game.add.sprite(game.world.centerX,ball.y+20, graphics.generateTexture());
	graphics.destroy();
	
	//create ball body
    ball.anchor.set(0.5);
    ball.checkWorldBounds = true;
    game.physics.enable(ball, Phaser.Physics.ARCADE);
    ball.body.collideWorldBounds = true;
	ball.body.bounce.set(1);
	
	//create paddle
	paddle.anchor.setTo(0.5,0.5);
	game.physics.enable(paddle, Phaser.Physics.ARCADE);
	paddle.body.collideWorldBounds = true;
    paddle.body.bounce.set(1);
    paddle.body.immovable = true;
    paddle.body.allowGravity = false;
    paddle.body.enable = true;

    //create the brick here

}

function update(){

}
// print out the value of your variables, including game, below, and check them in the console

</p>
			<div id="frame1" class='col-lg-12'>
				<iframe id="iframe1"></iframe>
			</div>
			<div class = "btn-group" role="group" aria-label="Editor Buttons">
				<button id="run1" class="btn btn-med btn-warning">Update <i class="fa fa-play fa-fw" aria-hidden="true"></i></button>
				<button id="reset1" class="btn btn-med btn-default">Reset <i class="fa fa-repeat fa-fw" aria-hidden="true"></i></button>
			</div>
			<p id = "editorContent1" style = "visibility:hidden;width:0px;height:0px;"></p>
		</div>
	</div>
	<!-- END EXERCISE -->

	<div class="row">
		<div class="col-lg-12">
			<p class='lead'>In order to create multiple bricks based on the code above as a sort of blueprint, we will use the Group feature of Phaser. This allows several game objects to be added to the group and share some physical characteristics. The following code creates a group:</p>
			<pre>bricks = game.add.group();</pre>
			<p class='lead'>Like a normal sprite, we can add the physics bodies to the group using the following code:</p>
			<pre>bricks.enableBody = true;
bricks.physicsBodyType = Phaser.Physics.ARCADE;</pre>
			<p class='lead'>Next, for artistic purposes, we will define an <b>array</b> of hex codes indicating a selection of different colors to be used for the bricks in each row. As we create the bricks in each row, we can use the color corresponding to that row to fill the texture.</p>
			<pre>var colors = [0x0000ff, 0x00ff00, 0xff0000, 0xf0f0f0];</pre>
			<p class='lead'>Since we are filling out a grid, is is easiest do use <b>nested for loops</b>, or one for loop inside another. The inner for loop will create the sprites for a single row, and the outer for loop will cause this to occur for multiple rows. For a grid of 4 rows with 13 bricks each, the basic structure will look like:</p>
			<pre>for (var y = 0; y < 4; y++)
{
	for (var x = 0; x < 13; x++)
	{

	}
}</pre>
			<p class='lead'>The drawing of a rectangle to generate a texture only needs to happen once per row, so this can be written within the outer for loop, before the inner for loop. <span class='codeText'>colors[y]</span> gives us the color corresponding to the current row. Unlike when we previously used graphics to draw, we don't want to destroy the current graphics immediately, as their content will be needed for creating the bricks in the inner for loop; the destruction will occur after the inner for loop. So, the loops will now be:</p>
			<pre>for (var y = 0; y < 4; y++)
{
	graphics = game.add.graphics(0, 0);
	graphics.beginFill(colors[y], 1);
	graphics.drawRect(350, 560, 40, 20);
	for (var x = 0; x < 13; x++)
	{
	    
	}
	graphics.destroy();
}</pre>
			<p class='lead'>With the textures prepared, we simply need to create bricks, give them physical bodies and characteristics, and add them to the group <span class='codeText'>bricks</span>. The positioning of each new sprite is where the  temporary loop variables come in handy. Within the inner for loop, the code is:</p>
			<pre>brick = bricks.create(104 + (x * 46), 100 + (y * 52), graphics.generateTexture());
brick.body.bounce.set(1);
brick.body.immovable = true;</pre>
			<p class='lead'>This code places the top left corner of the first brick at <span class='codeText'>x = 104, y = 100</span>, near the top left of the screen. Subsequent bricks are placed at multiples of 46 pixels to the right of the previous in each row, and subsequent rows start at multiples of 52 pixels below the previous row. This produces a grid with a little spacing in between the bricks (as they are height 20 and width 40). Also, notice that we used <span class='codeText'>bricks.create(...)</span> instead of <span class='codeText'>game.add.sprite(...)</span> to create the sprites; the former automatically adds the new sprite to the object group.<br><br>
			Now, the full loop code to create the bricks is as follows:</p>
			<pre>for (var y = 0; y < 4; y++)
{
	graphics = game.add.graphics(0, 0);
	graphics.beginFill(colors[y], 1);
	graphics.drawRect(350, 560, 40, 20);
	for (var x = 0; x < 13; x++)
	{
	    var brick = bricks.create(104 + (x * 46), 100 + (y * 52), graphics.generateTexture());
	    brick.body.bounce.set(1);
	    brick.body.immovable = true;
	}
	graphics.destroy();
}</pre>
		</div>
	</div>

	<!-- EXERCISE -->
	<div class="row" id = "exercise2">
		<div id="editorContainer2" class = 'col-lg-12' style = "background-color:#ecf0f1; padding-top:10px; padding-bottom:10px;">
			<p style='color:#7f8c8d;'>Create the object group called bricks and give it some physical properties. Create the array of colors. Then, instead of placing just one brick, use the loop code described above to create the grid of bricks of different colors.<br></p>
			<p style='color:#7f8c8d;'>If your code works properly, the bricks should all appear on screen.</p>
			<div id="editor2" class='editor col-lg-12'>var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

// add variables here
var ball;
var paddle;
var bricks;

// assign values to these variables
var ballOnPaddle = true;
var lives = 3;
var score = 0;

function preload(){

}

function create(){
	// add the initializing code below
	game.physics.startSystem(Phaser.Physics.ARCADE);
	game.physics.arcade.checkCollision.down = false;

	var graphics = game.add.graphics(0, 0);
	graphics.beginFill(0x68b0fd, 1);
	graphics.drawCircle(400, 550, 20);
	ball = game.add.sprite(game.world.centerX, 520, graphics.generateTexture());
	graphics.destroy();

	graphics = game.add.graphics(0, 0);
	graphics.beginFill(0xFFFFFF, 1);
	graphics.drawRect(350, 560, 100, 20);
	paddle = game.add.sprite(game.world.centerX,ball.y+20, graphics.generateTexture());
	graphics.destroy();
	
	//create ball body
    ball.anchor.set(0.5);
    ball.checkWorldBounds = true;
    game.physics.enable(ball, Phaser.Physics.ARCADE);
    ball.body.collideWorldBounds = true;
	ball.body.bounce.set(1);
	
	//create paddle
	paddle.anchor.setTo(0.5,0.5);
	game.physics.enable(paddle, Phaser.Physics.ARCADE);
	paddle.body.collideWorldBounds = true;
    paddle.body.bounce.set(1);
    paddle.body.immovable = true;
    paddle.body.allowGravity = false;
    paddle.body.enable = true;

    //create the bricks here

}

function update(){

}
// print out the value of your variables, including game, below, and check them in the console

</div>
			<p hidden id='defaultCode1'>var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

// add variables here
var ball;
var paddle;
var bricks;

// assign values to these variables
var ballOnPaddle = true;
var lives = 3;
var score = 0;

function preload(){

}

function create(){
	// add the initializing code below
	game.physics.startSystem(Phaser.Physics.ARCADE);
	game.physics.arcade.checkCollision.down = false;

	var graphics = game.add.graphics(0, 0);
	graphics.beginFill(0x68b0fd, 1);
	graphics.drawCircle(400, 550, 20);
	ball = game.add.sprite(game.world.centerX, 520, graphics.generateTexture());
	graphics.destroy();

	graphics = game.add.graphics(0, 0);
	graphics.beginFill(0xFFFFFF, 1);
	graphics.drawRect(350, 560, 100, 20);
	paddle = game.add.sprite(game.world.centerX,ball.y+20, graphics.generateTexture());
	graphics.destroy();
	
	//create ball body
    ball.anchor.set(0.5);
    ball.checkWorldBounds = true;
    game.physics.enable(ball, Phaser.Physics.ARCADE);
    ball.body.collideWorldBounds = true;
	ball.body.bounce.set(1);
	
	//create paddle
	paddle.anchor.setTo(0.5,0.5);
	game.physics.enable(paddle, Phaser.Physics.ARCADE);
	paddle.body.collideWorldBounds = true;
    paddle.body.bounce.set(1);
    paddle.body.immovable = true;
    paddle.body.allowGravity = false;
    paddle.body.enable = true;

    //create the bricks here

}

function update(){

}
// print out the value of your variables, including game, below, and check them in the console

</p>
			<div id="frame2" class='col-lg-12'>
				<iframe id="iframe2"></iframe>
			</div>
			<div class = "btn-group" role="group" aria-label="Editor Buttons">
				<button id="run2" class="btn btn-med btn-warning">Update <i class="fa fa-play fa-fw" aria-hidden="true"></i></button>
				<button id="reset2" class="btn btn-med btn-default">Reset <i class="fa fa-repeat fa-fw" aria-hidden="true"></i></button>
			</div>
			<p id = "editorContent2" style = "visibility:hidden;width:0px;height:0px;"></p>
		</div>
	</div>
	<!-- END EXERCISE -->

	<div class="row">
		<div class="col-lg-12">
			<p class='lead'>The last step in setting up the <b>create</b> function is adding text to the screen for displaying the number of lives, the score, and the introductory text. This is built in to the Phaser Game object and can be done using the following code:</p>
			<pre>scoreText = game.add.text(32, 550, 'score: 0', { font: "20px Arial", fill: "#ffffff", align: "left" });
livesText = game.add.text(680, 550, 'lives: 3', { font: "20px Arial", fill: "#ffffff", align: "left" });
introText = game.add.text(game.world.centerX, 400, '- click to start -', { font: "40px Arial", fill: "#ffffff", align: "center" });
introText.anchor.setTo(0.5, 0.5);</pre>
			<p class='lead'>This will be added in for you in the next exercise.</p>
		</div>
	</div>

	<div class = "col-lg-4 col-lg-offset-4" style = "margin-top:40px;">
		<a href = "controlFlow.html" class="btn btn-lg btn-block btn-warning" style="color:white;text-decoration:none;"><h4>Next<i class="fa fa-caret-right fa-fw" aria-hidden="true"></i></h4></a>
	</div>

</div>
{% endblock %}

{% block js %}
<script type="text/javascript">
	$(document).ready(function(){
		activateGameEditor(1);
		activateGameEditor(2);
	});
	
</script>
{% endblock %}